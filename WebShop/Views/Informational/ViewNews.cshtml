@model List<WebShop.Models.NewsViewModel>

@{
    ViewBag.Title = "Новости библиотеки";
}

@section Styles {
    <style>
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .news-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 2px solid #f8f9fa;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: block;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

            .news-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 30px rgba(0,0,0,0.12);
                text-decoration: none;
                color: inherit;
                border-color: #3498db;
            }

            .news-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(135deg, #667eea, #764ba2);
            }

        .news-header {
            margin-bottom: 15px;
        }

        .news-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .news-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f8f9fa;
            padding: 6px 12px;
            border-radius: 15px;
            color: #5d6d7e;
        }

        .news-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px solid #ecf0f1;
        }

        .news-content {
            color: #5d6d7e;
            line-height: 1.6;
            font-size: 0.95rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            transition: all 0.3s ease;
        }

            .news-content.expanded {
                -webkit-line-clamp: unset;
                display: block;
            }

        .news-tags {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #5d6d7e;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #7f8c8d;
            background: white;
            border-radius: 20px;
            margin: 40px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px 0;
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

            .page-header::before {
                content: '📚';
                position: absolute;
                top: 20px;
                right: 20px;
                font-size: 4rem;
                opacity: 0.1;
            }

        .page-title {
            font-size: 2.3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .page-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        .welcome-message {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(67, 233, 123, 0.3);
        }

        .welcome-text {
            font-size: 1.1rem;
            margin: 0;
            font-weight: 500;
        }

        .read-more {
            color: #3498db;
            font-weight: 600;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

            .read-more:hover {
                color: #2980b9;
            }

        .pagination-wrap {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 40px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .news-count {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .featured-badge {
            background: linear-gradient(135deg, #ff6b6b, #ffa8a8);
            color: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 2;
        }

        .news-full-content {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ecf0f1;
            color: #5d6d7e;
            line-height: 1.6;
        }

            .news-full-content.show {
                display: block;
            }

        .read-less {
            color: #e74c3c;
            font-weight: 600;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            cursor: pointer;
        }
    </style>
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Обработчик для кнопки "Читать далее"
            document.querySelectorAll('.read-more').forEach(button => {
                button.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const newsCard = this.closest('.news-card');
                    const content = newsCard.querySelector('.news-content');
                    const fullContent = newsCard.querySelector('.news-full-content');
                    const readMoreBtn = newsCard.querySelector('.read-more');

                    // Переключаем состояние
                    if (content.classList.contains('expanded')) {
                        // Скрываем полный текст
                        content.classList.remove('expanded');
                        fullContent.classList.remove('show');
                        readMoreBtn.innerHTML = 'Читать далее <span style="font-size: 0.8rem;">→</span>';
                    } else {
                        // Показываем полный текст
                        content.classList.add('expanded');
                        fullContent.classList.add('show');
                        readMoreBtn.innerHTML = 'Свернуть <span style="font-size: 0.8rem;">↑</span>';
                    }
                });
            });

            // Обработчик для клика по всей карточке (альтернативный вариант)
            document.querySelectorAll('.news-card').forEach(card => {
                card.addEventListener('click', function (e) {
                    // Не срабатывает если кликнули на кнопку "Читать далее"
                    if (!e.target.closest('.read-more')) {
                        const content = this.querySelector('.news-content');
                        const fullContent = this.querySelector('.news-full-content');
                        const readMoreBtn = this.querySelector('.read-more');

                        if (content && !content.classList.contains('expanded')) {
                            content.classList.add('expanded');
                            if (fullContent) fullContent.classList.add('show');
                            if (readMoreBtn) readMoreBtn.innerHTML = 'Свернуть <span style="font-size: 0.8rem;">↑</span>';
                        }
                    }
                });
            });
        });

        // Функция для генерации полного текста новости (заглушка)
        function generateFullContent(shortContent) {
            return shortContent + " " + "Это полная версия новости с дополнительными деталями и информацией. Здесь может быть более подробное описание события, дополнительные факты, цитаты участников или другая важная информация, которая не вошла в краткое описание.";
        }
    </script>
}



<div class="container-fluid">
    <div class="welcome-message">
        <p class="welcome-text">🎉 Рады видеть вас здесь! Читайте наши новости и будьте в курсе всех библиотечных событий</p>
    </div>

    @if (!Model.Any())
    {
        <div class="empty-state">
            <div class="empty-icon">📰</div>
            <h3 style="color: #5d6d7e; margin-bottom: 15px; font-weight: 600;">Пока здесь тихо...</h3>
            <p style="color: #7f8c8d; font-size: 1rem; line-height: 1.5; max-width: 400px; margin: 0 auto;">
                Но не расстраивайтесь! Скоро появятся интересные новости о наших мероприятиях, новых книгах и событиях.
            </p>
            <div style="margin-top: 25px;">
                <a href="@Url.Action("ViewNews", "Informational")" style="background: #3498db; color: white; padding: 12px 25px; border-radius: 25px; text-decoration: none; font-weight: 600; display: inline-block;">
                    Вернуться на главную
                </a>
            </div>
        </div>
    }
    else
    {
        <div class="news-count">
            📊 Нашли для вас @Model.Count новостей
        </div>

        <div class="news-grid">
            @foreach (var news in Model)
            {
                <div class="news-card">
                 

                    <div class="news-header">
                        <h3 class="news-title">@news.Title</h3>
                        <div class="news-meta">
                            <div class="meta-item">
                                <span>👤</span>
                                <span>@news.Author</span>
                            </div>
                            <div class="meta-item">
                                <span>📅</span>
                                <span>@DateTime.Now.ToString("dd MMM yyyy")</span>
                            </div>
                            <div class="meta-item" style="background: #e3f2fd; color: #1976d2;">
                                <span>🏷️</span>
                                <span>@news.Category</span>
                            </div>
                        </div>
                    </div>

                    @if (news.ImageData != null && news.ImageMimeType != null)
                    {
                        var base64 = Convert.ToBase64String(news.ImageData);
                        var imgSrc = String.Format("data:{0};base64,{1}", news.ImageMimeType, base64);
                        <img src="@imgSrc" alt="Изображение новости" class="news-image" />
                    }
                    else
                    {
                        <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); height: 180px; border-radius: 12px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: #5d6d7e;">
                            📚
                        </div>
                    }

                    <div class="news-content">
                        @news.Content
                    </div>

                    <!-- Полный текст новости (изначально скрыт) -->
                 

                    <div class="read-more">
                        Читать далее
                        <span style="font-size: 0.8rem;">→</span>
                    </div>

                    @if (!string.IsNullOrEmpty(news.Tags))
                    {
                        <div class="news-tags">
                            @foreach (var tag in news.Tags.Split(',').Take(3))
                            {
                                <span class="tag">#@tag.Trim()</span>
                            }
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Пагинация -->
        <div class="pagination-wrap">
            <div style="text-align: center; margin-bottom: 15px; color: #7f8c8d; font-size: 0.9rem;">
                Страница 3 из 12
            </div>
            <div class="pagination" style="justify-content: center;">
                <a class="pagination__prev" href="#" style="background: #f8f9fa; padding: 10px 15px; border-radius: 10px; margin-right: 10px;">
                    <svg class="icon icon-arrow-left pagination__icon">
                        <use href="~/assets/images/svg/symbol/sprite.svg#arrow-left"></use>
                    </svg>
                </a>
                <ul class="pagination__list">
                    <li class="pagination__item"><a class="pagination__link" href="#" style="padding: 8px 15px; border-radius: 8px;">1</a></li>
                    <li class="pagination__item"><a class="pagination__link" href="#" style="padding: 8px 15px; border-radius: 8px;">2</a></li>
                    <li class="pagination__item"><a class="pagination__link active" href="#" style="background: #3498db; color: white; padding: 8px 15px; border-radius: 8px;">3</a></li>
                    <li class="pagination__item"><a class="pagination__link" href="#" style="padding: 8px 15px; border-radius: 8px;">4</a></li>
                    <li class="pagination__item" style="display: flex; align-items: center; padding: 0 10px;">...</li>
                    <li class="pagination__item"><a class="pagination__link" href="#" style="padding: 8px 15px; border-radius: 8px;">12</a></li>
                </ul>
                <a class="pagination__next" href="#" style="background: #f8f9fa; padding: 10px 15px; border-radius: 10px; margin-left: 10px;">
                    <svg class="icon icon-arrow-right pagination__icon">
                        <use href="~/assets/images/svg/symbol/sprite.svg#arrow-right"></use>
                    </svg>
                </a>
            </div>
        </div>
    }
</div>